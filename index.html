<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valutatore Verifiche – Multi-file v1.11.18</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./assets/css/styles.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <header class="mb-4 d-flex align-items-center justify-content-between">
    <h1 class="h3 mb-0">Valutatore Verifiche</h1>
    <div class="text-muted">Multi-file v1.11.18</div>
  </header>

  <section class="section-card" id="setupSection">
    <h2 class="h5 mb-3">1) Configurazione</h2>
    <div class="mb-4">
      <h3 class="h6 mb-2">Dettagli verifica</h3>
      <div class="row g-3">
        <div class="col-12 col-md-6 col-xl-3">
          <label for="metaSubject" class="form-label mb-1">Materia</label>
          <input type="text" id="metaSubject" class="form-control" placeholder="Es. Matematica" data-meta-field="subject" />
        </div>
        <div class="col-12 col-md-6 col-xl-3">
          <label for="metaExamName" class="form-label mb-1">Nome della verifica</label>
          <input type="text" id="metaExamName" class="form-control" placeholder="Es. Verifica sulle frazioni" data-meta-field="examName" />
        </div>
        <div class="col-12 col-md-6 col-xl-3">
          <label for="metaDate" class="form-label mb-1">Data</label>
          <input type="date" id="metaDate" class="form-control" data-meta-field="date" />
        </div>
        <div class="col-12 col-md-6 col-xl-3">
          <label for="metaClass" class="form-label mb-1">Classe</label>
          <input type="text" id="metaClass" class="form-control" placeholder="Es. 3B" data-meta-field="classRoom" />
        </div>
      </div>
    </div>
    <div class="mb-4">
      <h3 class="h6">Elenco studenti</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <div class="d-flex flex-wrap gap-2 align-items-center">
            <input type="file" id="studentFile" accept=".txt,.csv,.tsv,text/plain" class="form-control w-auto" />
            <button id="clearStudentsBtn" class="btn btn-outline-secondary" type="button">Svuota</button>
          </div>
          <div id="studentsDrop" class="dropzone mt-2">Trascina qui un file .txt/.csv (un nome per riga)</div>
        </div>
        <div class="col-12 col-lg-6">
          <label for="studentsPaste" class="form-label mb-1">Oppure incolla (uno per riga, o separati da virgola/punto e virgola)</label>
          <textarea id="studentsPaste" class="form-control" rows="4" placeholder="Mario Rossi&#10;Lucia Bianchi&#10;..."></textarea>
          <div class="mt-2">
            <button id="parseStudentsPasteBtn" class="btn btn-outline-primary btn-sm" type="button">Importa da testo</button>
          </div>
        </div>
      </div>
      <div id="studentsPreview" class="mt-3"></div>
    </div>

    <hr />

    <div class="mb-4">
      <h3 class="h6 mb-2">Indicatori</h3>
      <div class="table-responsive">
        <table class="table table-sm align-middle" id="indicatorsTable">
          <thead>
            <tr>
              <th style="width:8%">ID</th>
              <th style="width:57%">Nome</th>
              <th style="width:20%">Punteggio massimo</th>
              <th style="width:15%" class="text-end">
                <button id="addIndicatorRow" class="btn btn-sm btn-outline-success" type="button">+ Aggiungi indicatore</button>
              </th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div>Fasce: <strong>Eccellente (100%)</strong>, <strong>Buono (80%)</strong>, <strong>Sufficiente (60%)</strong>, <strong>Insufficiente (45%)</strong>, <strong>Gravemente insufficiente (20%)</strong>.</div>
    </div>

    <hr />

    <div class="mb-3">
      <h3 class="h6 mb-2">Esercizi</h3>
      <div class="row g-2 align-items-end mb-2">
        <div class="col-auto">
          <label for="exerciseCount" class="form-label">Numero esercizi</label>
          <input type="number" min="1" id="exerciseCount" class="form-control" placeholder="es. 6" />
        </div>
        <div class="col-auto">
          <button id="generateExercisesBtn" class="btn btn-outline-primary" type="button">Rigenera elenco esercizi</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-sm align-middle" id="exercisesTable">
          <thead>
            <tr>
              <th style="width:10%">ID</th>
              <th style="width:20%">Modificatore (−/+ decimali)</th>
              <th>Indicatori coperti</th>
              <th class="text-end" style="width: 10%"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="alert alert-info" id="setupPreview">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <span class="me-2">Totale teorico (tutti in Eccellente):</span>
          <span class="badge text-bg-primary total-badge" data-setup-total>0.0</span>
          <span class="ms-3 me-2">Scarto da 10:</span>
          <span class="badge text-bg-warning total-badge" data-setup-delta>+10.0</span>
        </div>
      </div>
      <div class="mt-2" id="coverageWarnings"></div>
    </div>

    <div class="d-flex gap-2">                
      <button id="startEvalBtn" class="btn btn-primary" type="button">Vai alla valutazione</button>
      <button id="exportConfigOnlyBtn" class="btn btn-outline-secondary" type="button">Esporta configurazione (JSON)</button>
      <label class="btn btn-outline-secondary mb-0">
        Importa configurazione o verifica completa (JSON)
        <input type="file" id="importFile" accept="application/json" hidden />
      </label>
    </div>
  </section>

  <section class="section-card d-none" id="evaluationSection">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h2 class="h5 mb-0">2) Valutazione</h2>
      <div class="d-flex gap-2">
        <button id="exportAllBtn" class="btn btn-outline-primary" type="button">Esporta tutto (JSON)</button>
        <button id="exportAllPDFZipBtn" class="btn btn-outline-danger" type="button">Esporta PDF di tutti (ZIP)</button>
        <button id="backToSetupBtn" class="btn btn-outline-secondary" type="button">← Torna alla configurazione</button>
      </div>
    </div>
    <div id="evaluationMeta" class="alert alert-secondary small d-none" role="status"></div>

    <ul class="nav nav-tabs" id="studentsTabs" role="tablist"></ul>
    <div class="tab-content" id="studentsTabContent"></div>
  </section>

  <script src="./assets/js/utils.js"></script>
  <script src="./assets/js/state.js"></script>
  <script src="./assets/js/setup.js"></script>
  <script src="./assets/js/evaluation.js"></script>
  <script src="./assets/js/storage.js"></script>
  <script src="./assets/js/pdf.js"></script>
  <script src="./assets/js/main.js"></script>
</body>
</html>
